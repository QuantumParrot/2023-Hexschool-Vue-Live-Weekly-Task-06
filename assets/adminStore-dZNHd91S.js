import{a as o,S as n,m as l}from"./messageStore-r8FGZWJD.js";import{i as u,a as h}from"./index-q7ML1dqU.js";import{l as m}from"./loadingStore-TgtJ6Wx-.js";var p={VITE_APP_SITE:"https://ec-course-api.hexschool.io/v2",VITE_APP_PATH:"ataraxia",BASE_URL:"/2023-Hexschool-Vue-Live-Weekly-Task-06",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_SITE:s,VITE_APP_PATH:i}=p,L=u("adminStore",{state:()=>({products:[],orders:[]}),getters:{tags:({products:e})=>{const r=[];return e.forEach(t=>Array.isArray(t.tags)&&t.tags.forEach(a=>{r.find(d=>d===a)||r.push(a)})),r}},actions:{...h(m,["createLoader","removeLoader"]),...h(l,["toastAlert","errorHandle"]),login(e,{resetForm:r}){this.createLoader("login"),o.post(`${s}/admin/signin`,e).then(t=>{const{expired:a,message:c,token:d}=t.data;document.cookie=`hexVueToken=${d}; expires=${new Date(a)}`,this.toastAlert(c,"success"),setTimeout(()=>{r(),this.router.replace("/admin")},1500)}).catch(t=>this.errorHandle(t,"error")).finally(()=>this.removeLoader("login"))},checkLogin(e){var t;const r=(t=document.cookie.split("; ").find(a=>a.startsWith("hexVueToken=")))==null?void 0:t.split("=")[1];r?(this.createLoader("checkLogin"),o.defaults.headers.common.Authorization=r,o.post(`${s}/api/user/check`).then(()=>{e==="admin-products"?this.getProducts():e==="admin-orders"?this.getOrders():this.router.replace("/admin/products")}).catch(a=>{e!=="/admin-login"&&(this.errorHandle(a,"error"),this.router.replace("/admin-login"))}).finally(()=>this.removeLoader("checkLogin"))):this.router.push("/admin-login")},getProducts(){this.createLoader("getAdminProducts"),o.get(`${s}/api/${i}/admin/products/all`).then(e=>{this.products=Object.values(e.data.products)}).catch(e=>this.errorHandle(e)).finally(()=>this.removeLoader("getAdminProducts"))},switchProductStatus(e){this.createLoader("switchProductStatus");const r=e.is_enabled;o.put(`${s}/api/${i}/admin/product/${e.id}`,{data:{...e,is_enabled:!e.is_enabled}}).then(()=>{this.toastAlert(r?"成功下架":"成功上架","success"),this.getProducts()}).catch(t=>this.errorHandle(t)).finally(()=>this.removeLoader("switchProductStatus"))},deleteProduct(e){n.fire({title:"確定刪除商品？",text:"此操作無法復原，你要確定喔！",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",confirmButtonText:"確定",cancelButtonText:"取消"}).then(r=>{r.isConfirmed&&(this.createLoader("deleteProduct"),o.delete(`${s}/api/${i}/admin/product/${e}`).then(()=>{this.toastAlert("我們懷念它 (´;ω;`)","success"),this.getProducts()}).catch(t=>this.errorHandle(t)).finally(()=>this.removeLoader("deleteProduct")))})},createProduct(e,r){this.createLoader("createProduct"),o.post(`${s}/api/${i}/admin/product`,{data:e}).then(t=>{this.toastAlert(t.data.message,"success"),r(),this.getProducts()}).catch(t=>this.errorHandle(t)).finally(()=>this.removeLoader("createProduct"))},updateProduct(e,r){this.createLoader("updateProduct"),o.put(`${s}/api/${i}/admin/product/${e.id}`,{data:e}).then(t=>{this.toastAlert(t.data.message,"success"),r(),this.getProducts()}).catch(t=>this.errorHandle(t)).finally(()=>this.removeLoader("updateProduct"))},getOrders(){this.createLoader("getAdminOrders"),o.get(`${s}/api/${i}/admin/orders`).then(e=>{this.orders=e.data.orders}).catch(e=>this.errorHandle(e)).finally(()=>this.removeLoader("getAdminOrders"))},deleteOrder(e){n.fire({title:"你確定要蛋雕 ... 刪除訂單！？",text:"此操作無法復原，客戶的信任也是，你要確定欸！",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",confirmButtonText:"確定",cancelButtonText:"取消"}).then(r=>{r.isConfirmed&&(this.createLoader("deleteOrder"),o.delete(`${s}/api/${i}/admin/order/${e}`).then(t=>{this.toastAlert(t.data.message,"success"),this.getOrders()}).catch(t=>this.errorHandle(t)).finally(()=>this.removeLoader("deleteOrder")))})}}});export{L as a};
