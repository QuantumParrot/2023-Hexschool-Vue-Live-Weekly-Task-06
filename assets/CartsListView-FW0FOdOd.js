import{j as T,a as u,m as f,_ as S,o as d,c as r,b as e,d as a,w as m,n as b,t as l,e as n,r as h,F as C,h as k,k as V,v as x,i as A}from"./index-pQWg6EHF.js";import{l as F}from"./loadingStore-h-BplzEJ.js";import{S as O,a as E,m as P}from"./messageStore-ThBgcMdp.js";import{c as g}from"./cartStore-DzH4K2Sz.js";import{v as D}from"./validation-92p_Zyy8.js";var j={VITE_APP_SITE:"https://ec-course-api.hexschool.io/v2",VITE_APP_PATH:"ataraxia",BASE_URL:"/2023-Hexschool-Vue-Live-Weekly-Task-06",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_SITE:B,VITE_APP_PATH:I}=j,w=T("orderStore",{state:()=>({showForm:!1}),actions:{...u(F,["createLoader","removeLoader"]),...u(P,["toastAlert","errorHandle"]),...u(g,["getCartsData"]),displayForm(){this.showForm=!0},submitOrder(s,{resetForm:i}){O.fire({title:"確定送出訂單？",showCancelButton:!0,confirmButtonColor:"#dc3545",confirmButtonText:"確定",cancelButtonText:"取消"}).then(v=>{if(v.isConfirmed){this.createLoader("submitOrder");const $={user:{name:s.name,address:s.address,tel:s.tel,email:s.email},message:JSON.stringify({message:s.message||"無",project:s.project,state:0}),state:0};E.post(`${B}/api/${I}/order`,{data:$}).then(p=>{i(),this.toastAlert(`${p.data.message}，感謝您的訂購！`,"success"),this.getCartsData()}).catch(p=>this.errorHandle(p,"error")).finally(()=>this.removeLoader("submitOrder"))}})}}}),M={mixins:[D],computed:{...f(g,["carts"])},methods:{...u(w,["submitOrder"])}},N={class:"container py-5"},z={class:"row justify-content-center"},q={class:"col-md-6"},H=e("h3",{class:"mb-4"},"填寫寄送資訊",-1),R=e("div",{class:"alert bg-secondary-subtle px-4"},[e("span",{class:"text-danger me-2"},"*"),n("為必填欄位哦！ ")],-1),U={class:"mb-3"},Q=e("label",{for:"name",class:"form-label"},[e("span",{class:"text-danger fst-italic me-1"},"*"),n(" 您的大名")],-1),J={class:"invalid-feedback"},W={class:"mb-3"},G=e("label",{for:"email",class:"form-label"},[e("span",{class:"text-danger fst-italic me-1"},"*"),n(" 電子信箱")],-1),K={class:"invalid-feedback"},X={class:"mb-3"},Y=e("label",{for:"tel",class:"form-label"},[e("span",{class:"text-danger fst-italic me-1"},"*"),n(" 您的手機")],-1),Z={class:"invalid-feedback"},ee={class:"mb-3"},se=e("label",{for:"address",class:"form-label"},[e("span",{class:"text-danger fst-italic me-1"},"*"),n(" 寄送地址")],-1),te={class:"invalid-feedback"},oe={class:"mb-3"},ae=e("label",{for:"project",class:"form-label"},"選擇要贊助的專案（ 我們會將收入的 20% 投注於此！ ）",-1),le=e("option",{value:"",selected:""},"不指定",-1),ne=e("option",{value:"偏鄉小學移動圖書館"},"偏鄉小學行動圖書館",-1),ie=e("option",{value:"獨居老人關懷計畫"},"獨居老人關懷計畫",-1),de=e("option",{value:"野生動物救援行動"},"野生動物救援行動",-1),re={class:"mb-3"},ce=e("label",{for:"message",class:"form-label"},"備註與留言",-1),me=["disabled"];function _e(s,i,v,$,p,L){const c=h("VField"),_=h("ErrorMessage"),y=h("VForm");return d(),r("div",N,[e("div",z,[e("div",q,[H,R,a(y,{class:"card p-4",onSubmit:s.submitOrder},{default:m(({errors:t})=>[e("div",U,[Q,a(c,{type:"text",id:"name",class:b(["form-control mb-2",{"is-invalid":t.name}]),name:"name",rules:"required"},null,8,["class"]),a(_,{name:"name"},{default:m(({message:o})=>[e("p",J,l(s.localizeMessage(o,"name")),1)]),_:1})]),e("div",W,[G,a(c,{type:"email",id:"email",class:b(["form-control mb-2",{"is-invalid":t.email}]),name:"email",rules:"required|email"},null,8,["class"]),a(_,{name:"email"},{default:m(({message:o})=>[e("p",K,l(s.localizeMessage(o,"email")),1)]),_:1})]),e("div",X,[Y,a(c,{type:"tel",id:"tel",class:b(["form-control mb-2",{"is-invalid":t.tel}]),name:"tel",rules:s.tel},null,8,["class","rules"]),a(_,{name:"tel"},{default:m(({message:o})=>[e("p",Z,l(s.localizeMessage(o,"tel")),1)]),_:1})]),e("div",ee,[se,a(c,{type:"text",id:"address",class:b(["form-control mb-2",{"is-invalid":t.address}]),name:"address",rules:"required"},null,8,["class"]),a(_,{name:"address"},{default:m(({message:o})=>[e("p",te,l(s.localizeMessage(o,"address")),1)]),_:1})]),e("div",oe,[ae,a(c,{id:"project",class:"form-select mb-2",value:"",name:"project",as:"select"},{default:m(()=>[le,ne,ie,de]),_:1})]),e("div",re,[ce,a(c,{id:"message",class:"form-control mb-2",rows:"5",name:"message",as:"textarea"})]),e("button",{type:"submit",class:"btn btn-secondary",disabled:!s.carts.length}," 確定送出",8,me)]),_:1},8,["onSubmit"])])])])}const ue=S(M,[["render",_e]]),he={components:{OrderForm:ue},computed:{...f(F,["isLoading"]),...f(w,["showForm"]),...f(g,["carts","total"])},methods:{...u(w,["displayForm"]),...u(g,["getCartsData","changeCartQty","deleteCartItem","deletAllCart"])},mounted(){this.getCartsData()}},pe={class:"container pt-5"},be=e("h2",{class:"fw-bolder mb-5"},"購物車",-1),fe={key:0,class:"alert bg-secondary-subtle"},ge={key:1,class:"table"},ve=e("thead",null,[e("tr",null,[e("th",{width:"10%"},"處理"),e("th",{width:"50%"},"商品"),e("th",{width:"15%",class:"text-end"},"單價"),e("th",{width:"15%",class:"text-end"},"數量"),e("th",{width:"10%",class:"text-end"},"小計")])],-1),$e={class:"align-middle"},ye=["onClick"],Ce=e("i",{class:"bi bi-trash-fill me-2"},null,-1),we=e("span",null,"刪除",-1),ke=[Ce,we],Se=["src","alt"],Fe={class:"d-inline-block align-middle"},Le={class:"fs-5 fw-bold mb-1"},Te={class:"fs-7 fst-italic text-muted mb-0"},Ve={class:"text-end"},xe={key:0,class:"text-muted me-1 text-decoration-line-through"},Ae={class:"input-group ps-3"},Oe=["value","onChange"],Ee=["value"],Pe={class:"input-group-text"},De={class:"text-end fw-bold"},je={class:"fs-5 fw-bold"},Be={colspan:"5",class:"py-3"},Ie={class:"d-flex justify-content-between align-items-center"},Me={class:"d-flex align-items-center gap-3"},Ne=e("i",{class:"bi bi-cart-check-fill me-2"},null,-1),ze=e("span",null,"結帳",-1),qe=[Ne,ze];function He(s,i,v,$,p,L){const c=h("LoadingOverlay"),_=h("RouterLink"),y=h("OrderForm");return d(),r(C,null,[a(c,{active:s.isLoading,"onUpdate:active":i[0]||(i[0]=t=>s.isLoading=t),"z-index":1e3},null,8,["active"]),e("div",pe,[be,s.carts.length?(d(),r("table",ge,[ve,e("tbody",$e,[(d(!0),r(C,null,k(s.carts,t=>(d(),r("tr",{key:t.id},[e("td",null,[e("button",{type:"button",class:"btn btn-danger",onClick:o=>s.deleteCartItem(t.id)},ke,8,ye)]),e("td",null,[e("img",{class:"cart-img me-4",src:t.product.imageUrl,alt:t.product.title},null,8,Se),e("div",Fe,[e("p",Le,l(t.product.title),1),e("p",Te,l(t.product.content),1)])]),e("td",Ve,[n(" NT$ "),t.product.origin_price!==t.product.price?(d(),r("span",xe,l(t.product.origin_price),1)):A("",!0),e("span",null,l(t.product.price)+" 元",1)]),e("td",null,[e("div",Ae,[e("select",{class:"form-select",value:t.qty,onChange:o=>s.changeCartQty(t,o.target.value)},[(d(!0),r(C,null,k(10*Math.ceil((t.qty+1)/10),o=>(d(),r("option",{key:o,value:o},l(o),9,Ee))),128))],40,Oe),e("span",Pe,l(t.product.unit),1)])]),e("td",De,"NT$ "+l(t.total)+" 元",1)]))),128))]),e("tfoot",null,[e("tr",je,[e("td",Be,[e("div",Ie,[e("button",{type:"button",class:"btn btn-outline-danger",onClick:i[1]||(i[1]=(...t)=>s.deletAllCart&&s.deletAllCart(...t))},"清空購物車"),e("div",Me,[n(" 總計：NT$ "+l(s.total)+" 元 ",1),e("button",{type:"button",class:"btn btn-secondary",onClick:i[2]||(i[2]=(...t)=>s.displayForm&&s.displayForm(...t))},qe)])])])])])])):(d(),r("div",fe,[n(" 購物車內目前沒有商品，去"),a(_,{to:"/products"},{default:m(()=>[n("逛逛")]),_:1}),n("！ ")])),V(a(y,null,null,512),[[x,s.carts.length&&s.showForm]])])],64)}const Ge=S(he,[["render",He]]);export{Ge as default};
